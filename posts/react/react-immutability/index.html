<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.00d85c512e334fdca61e.css">html{font-size:100}body{margin:0 0 0 calc(100vw - 100%);font-family:Nanum Gothic,Noto Sans KR,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif;color:#222;line-height:1.625;font-size:1rem;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;text-rendering:optimizeLegibility;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}body.light-mode{background-color:#fff;color:#333;-webkit-transition:background-color .3s ease;transition:background-color .3s ease}body.dark-mode{color:#dfdfdf}body.dark-mode,body.dark-mode .topbar{background-color:#10171d}body.dark-mode .dark-mode-toggle>button{color:#999}body.dark-mode .dark-mode-toggle>button:last-child{color:#add8e6}body.dark-mode h1 a{color:#fff}body.dark-mode h1 a:hover{color:#5d93ff}body.dark-mode h2 a{color:#fff}body.dark-mode h2 a:hover{color:#5d93ff}body.dark-mode .home_button a,body.dark-mode time,body.dark-mode ul li a{color:#fff}body.dark-mode .content a,body.dark-mode .home_button a:hover{color:#5d93ff}body.dark-mode .content a:hover{color:#f7a046}.topbar{-webkit-box-pack:end;justify-content:flex-end}.dark-mode-toggle,.topbar{display:-webkit-box;display:flex}.dark-mode-toggle>button{font-size:1.2em;background:none;border:none;color:#ffe600;cursor:pointer;-webkit-transition:color .3s ease;transition:color .3s ease}.dark-mode-toggle>button:last-child{color:#666}.dark-mode-toggle>button:focus{outline:none}.toggle-control{position:relative;padding:0 .25rem;display:-webkit-box;display:flex;-webkit-box-align:center;align-items:center}input[type=checkbox].dmcheck{width:2.5rem;height:.625rem;background:#555;position:relative;border-radius:.3125rem;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;vertical-align:2px;outline:none}input[type=checkbox].dmcheck:checked+label{left:30px}input[type=checkbox].dmcheck:focus-visible{outline:2px solid #fff}input[type=checkbox].dmcheck+label{display:inline-block;width:1.125rem;height:1.125rem;border-radius:50%;-webkit-transition:all .3s ease;transition:all .3s ease;cursor:pointer;position:absolute;left:2px;background:#fff;opacity:.9;background-color:#f6f6f6}h1,h2,h3,h4,h5,h6{font-family:Nanum Gothic,Noto Sans KR,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif;font-weight:600}h1{font-size:2.5rem;line-height:3.25rem;margin-top:1.625rem;margin-bottom:1.625rem}h2{font-size:1.6875rem;line-height:2.4375rem;margin-top:2.4375rem;margin-bottom:.8125rem}h3{font-size:1.375rem}h3,h4{line-height:1.625rem;margin-top:2.4375rem;margin-bottom:.8125rem}h4{font-size:1.2rem}h5,h6{font-size:1rem;line-height:1.625rem;margin-top:2.4375rem;margin-bottom:.8125rem}img{max-width:100%;margin:inherit auto}hr,img{border:0;display:block}hr{color:#e2e2e2;height:1.625rem;margin:2rem auto;background-size:100% 26px;background-image:linear-gradient(180deg,transparent 1px,transparent 11px,#e2e2e2 0,#e2e2e2 15px,transparent 0,transparent 26px);width:18.75rem}a{color:#5d93ff;text-decoration:none}a:active,a:focus,a:hover{color:#f7a046}b,strong{font-weight:600}ul{list-style:square;margin-bottom:1.625rem}ul li{padding:0 .3125rem;margin-bottom:.625rem}p{line-height:1.625rem;margin-bottom:1.625rem}blockquote{padding:0;font-style:italic;text-align:center;color:#737373}figure{display:block;width:100%;height:auto}figcaption{line-height:1.21875rem;margin-top:.40625rem;color:#222;font-size:.875rem;font-style:italic;margin-bottom:0;text-align:center}.anchor{margin-left:-1.875rem!important;padding-right:.875rem!important}@media screen and (min-width:685px){figure.float-left,figure.float-right{max-width:19.375rem;padding:0 1.625rem}.float-right{float:right}.float-left{float:left}}table{border:1px solid #a7a7a7;border-collapse:collapse}td,th{border:1px solid #a7a7a7;padding:.625rem}code[class*=language-],pre[class*=language-]{color:#f7f7f7;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}code[class*=language-]::selection,code[class*=language-] ::selection,pre[class*=language-]::selection,pre[class*=language-] ::selection{background:#073642}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto;border-radius:.3em}:not(pre)>code[class*=language-]{background-color:#efefef;color:#6d6d6d}pre[class*=language-]{background-color:#282c34}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#93a1a1}.token.punctuation{color:#586e75}.namespace{opacity:.7}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:#268bd2}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string,.token.url{color:#2aa198}.token.entity{color:#657b83;background:#eee8d5}.token.atrule,.token.attr-value,.token.keyword{color:#859900}.token.class-name,.token.function{color:#b58900}.token.important,.token.regex,.token.variable{color:#cb4b16}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.Author-module--author__photo--36xCH{display:inline-block;margin-bottom:0;border-radius:50%;background-clip:padding-box}.Author-module--author__title--2CaTb{font-size:1.125rem;font-weight:600;line-height:1.82813rem;margin:.8125rem 0}.Author-module--author__title-link--Yrism,.Author-module--author__title-link--Yrism:focus,.Author-module--author__title-link--Yrism:hover{color:#222}.Author-module--author__subtitle--cAaEB{color:#888;line-height:1.625rem;margin-bottom:1.625rem}.Icon-module--icon--Gpyvw{display:inline-block;width:1em;height:1em;stroke-width:0;stroke:currentColor;fill:currentColor;font-style:normal;font-weight:400;speak:none;margin-right:.2em;text-align:center;font-variant:normal;text-transform:none;line-height:1em;margin-left:.2em;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.Contacts-module--contacts--1rGd1{margin-bottom:1.625rem}.Contacts-module--contacts__list--3OgdW{display:-webkit-box;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;flex-flow:row wrap;-webkit-box-flex:0;flex-grow:0;flex-shrink:0;list-style:none;padding:0;margin:.625rem -.1875rem;width:8.75rem}.Contacts-module--contacts__list-item--16p9q{padding:0;margin:.25rem;display:-webkit-box;display:flex;align-content:center;-webkit-box-align:center;align-items:center;-webkit-box-pack:center;justify-content:center;height:2.1875rem;width:2.1875rem;line-height:2.1875rem;border-radius:50%;text-align:center;border:1px solid #ebebeb}.Contacts-module--contacts__list-item-link--2MIDn{border:0;display:-webkit-box;display:flex;color:#222}.Contacts-module--contacts__list-item-link--2MIDn:focus,.Contacts-module--contacts__list-item-link--2MIDn:hover{color:#5d93ff}.Copyright-module--copyright--1ariN{color:#b6b6b6;font-size:.875rem}.Menu-module--menu--Efbin{margin-bottom:1.625rem}.Menu-module--menu__list--31Zeo{list-style:none;padding:0;margin:0}.Menu-module--menu__list-item--1lJ6B{padding:0;margin:.625rem 0}.Menu-module--menu__list-item-link--10Ush{font-size:1rem;color:#222;font-weight:400;border:0}.Menu-module--menu__list-item-link--10Ush:focus,.Menu-module--menu__list-item-link--10Ush:hover{color:#5d93ff;border-bottom:1px solid #5d93ff}.Menu-module--menu__list-item-link--active--2CbUO{color:#222;border-bottom:1px solid #222}.Sidebar-module--sidebar--X4z2p{width:100%}.Sidebar-module--sidebar__inner--Jdc5s{position:relative;padding:1.5625rem 1.25rem 0}@media screen and (min-width:685px){.Sidebar-module--sidebar--X4z2p{width:calc(41.625% - 1.09375rem)}.Sidebar-module--sidebar--X4z2p:nth-child(1n){float:left;margin-right:1.875rem;clear:none}.Sidebar-module--sidebar--X4z2p:last-child{margin-right:0}.Sidebar-module--sidebar--X4z2p:nth-child(12n){margin-right:0;float:right}.Sidebar-module--sidebar--X4z2p:nth-child(12n+1){clear:both}.Sidebar-module--sidebar__inner--Jdc5s{padding:1.875rem 1.25rem 0}.Sidebar-module--sidebar__inner--Jdc5s:after{background:#e6e6e6;background:-webkit-gradient(linear,left top,left bottom,from(#e6e6e6),color-stop(48%,#e6e6e6),to(#fff));background:linear-gradient(180deg,#e6e6e6 0,#e6e6e6 48%,#fff);position:absolute;content:"";width:.0625rem;height:33.75rem;top:30px;right:-10px;bottom:0}}@media screen and (min-width:960px){.Sidebar-module--sidebar--X4z2p{width:calc(33.3% - 1.25rem)}.Sidebar-module--sidebar--X4z2p:nth-child(1n){float:left;margin-right:1.875rem;clear:none}.Sidebar-module--sidebar--X4z2p:last-child{margin-right:0}.Sidebar-module--sidebar--X4z2p:nth-child(3n){margin-right:0;float:right}.Sidebar-module--sidebar--X4z2p:nth-child(3n+1){clear:both}.Sidebar-module--sidebar__inner--Jdc5s{padding:2.5rem}}.Layout-module--layout--3Pyz6{max-width:66.875rem;margin-left:auto;margin-right:auto}.Layout-module--layout--3Pyz6:before{content:"";display:table}.Layout-module--layout--3Pyz6:after{content:"";display:table;clear:both}.Feed-module--feed__item--2D5rE{margin-bottom:2.03125rem}.Feed-module--feed__item--2D5rE:last-child{margin-bottom:.8125rem}.Feed-module--feed__item-title--3nigr{font-size:1.6875rem;line-height:2.4375rem;margin-top:0;margin-bottom:.8125rem}.Feed-module--feed__item-title-link--iFMRs{color:#222}.Feed-module--feed__item-title-link--iFMRs:focus,.Feed-module--feed__item-title-link--iFMRs:hover{color:#222;border-bottom:1px solid #222}.Feed-module--feed__item-description--1uO8e{font-size:1rem;line-height:1.625rem;margin-bottom:1.21875rem}.Feed-module--feed__item-meta-time--3t1fg{font-size:.875rem;color:#222;font-weight:600;text-transform:uppercase}.Feed-module--feed__item-meta-divider--N-Q0A{margin:0 .3125rem}.Feed-module--feed__item-meta-category-link--23f8F{font-size:.875rem;color:#f7a046;font-weight:600;text-transform:uppercase}.Feed-module--feed__item-meta-category-link--23f8F:focus,.Feed-module--feed__item-meta-category-link--23f8F:hover{color:#5d93ff}.Feed-module--feed__item-readmore--1u6bI{font-size:1rem;color:#5d93ff}.Feed-module--feed__item-readmore--1u6bI:focus,.Feed-module--feed__item-readmore--1u6bI:hover{color:#5d93ff;border-bottom:1px solid #5d93ff}.Page-module--page--2nMky{margin-bottom:3.25rem}.Page-module--page__inner--2M_vz{padding:1.5625rem 1.25rem}.Page-module--page__title--GPD8L{font-size:2.5rem;font-weight:600;line-height:3.25rem;margin-top:0;margin-bottom:2.35625rem}.Page-module--page__body--Ic6i6{font-size:1rem;line-height:1.625rem;margin:0 0 1.625rem}@media screen and (min-width:685px){.Page-module--page--2nMky{width:calc(58.275% - .78125rem)}.Page-module--page--2nMky:nth-child(1n){float:left;margin-right:1.875rem;clear:none}.Page-module--page--2nMky:last-child{margin-right:0}.Page-module--page--2nMky:nth-child(12n){margin-right:0;float:right}.Page-module--page--2nMky:nth-child(12n+1){clear:both}.Page-module--page__inner--2M_vz{padding:1.875rem 1.25rem}}@media screen and (min-width:960px){.Page-module--page--2nMky{width:calc(66.6% - .625rem)}.Page-module--page--2nMky:nth-child(1n){float:left;margin-right:1.875rem;clear:none}.Page-module--page--2nMky:last-child{margin-right:0}.Page-module--page--2nMky:nth-child(3n){margin-right:0;float:right}.Page-module--page--2nMky:nth-child(3n+1){clear:both}.Page-module--page__inner--2M_vz{padding:2.5rem 2.1875rem}}.Pagination-module--pagination--2H3nO{margin-top:3.25rem;display:-webkit-box;display:flex}.Pagination-module--pagination__prev--bet5s{width:50%;text-align:left}.Pagination-module--pagination__prev-link--1Nzs6{color:#f7a046;font-size:1.625rem;font-weight:700}.Pagination-module--pagination__prev-link--1Nzs6:focus,.Pagination-module--pagination__prev-link--1Nzs6:hover{color:#5d93ff}.Pagination-module--pagination__prev-link--disable--Yklx9{pointer-events:none;color:#bbb}.Pagination-module--pagination__next--3hFiN{width:50%;text-align:right}.Pagination-module--pagination__next-link--3FUtA{color:#f7a046;font-size:1.625rem;font-weight:700}.Pagination-module--pagination__next-link--3FUtA:focus,.Pagination-module--pagination__next-link--3FUtA:hover{color:#5d93ff}.Pagination-module--pagination__next-link--disable--30UwZ{pointer-events:none;color:#bbb}.Author-module--author--2Yefr{border-top:1px solid #e6e6e6;max-width:40rem;padding-top:1.25rem;line-height:1.625rem;margin-top:1.625rem;margin-bottom:3.25rem}.Author-module--author__bio-twitter--n-O9n{display:block;text-decoration:underline}@media screen and (min-width:685px){.Author-module--author--2Yefr{margin-left:auto;margin-right:auto}}.Content-module--content--3p512{max-width:59.0625rem;padding:0 .9375rem;margin:0 auto}.Content-module--content__title--2BDW9{font-size:2rem;max-width:40rem;font-weight:600;text-align:center;line-height:2.68125rem;margin:1.625rem auto 0}.Content-module--content__body--2TrQ- figure{margin-bottom:1.625rem}.Content-module--content__body--2TrQ- figure blockquote{font-style:italic;text-align:center;margin-top:0;padding:1.625rem 0}.Content-module--content__body--2TrQ- figure blockquote p{max-width:40rem;font-size:1.6817rem;margin-top:0;margin-bottom:1.625rem;line-height:2.4375rem}.Content-module--content__body--2TrQ- a{text-decoration:underline}.Content-module--content__body--2TrQ- *{max-width:40rem;margin-left:auto;margin-right:auto}.Content-module--content__body--2TrQ- img{max-width:100%}@media screen and (min-width:960px){.Content-module--content--3p512{padding:0}.Content-module--content__title--2BDW9{font-size:3rem;line-height:3.65625rem;margin-top:3.65625rem;margin-bottom:2.4375rem}.Content-module--content__body--2TrQ-,.Content-module--content__body--2TrQ- p{font-size:1.125rem;line-height:1.82813rem;margin-bottom:1.82813rem}}.Meta-module--meta__date--29eD7{font-style:italic}.Tags-module--tags--1L_ct{margin-bottom:.8125rem}.Tags-module--tags__list--91FqN{list-style:none;margin:0 -.625rem;padding:0}.Tags-module--tags__list-item--1M30P{display:inline-block;margin:.625rem .3125rem}.Tags-module--tags__list-item-link--3SL_8{display:inline-block;height:2.1875rem;padding:0 1.5rem;line-height:2.1875rem;border:1px solid #e6e6e6;text-decoration:none;border-radius:1.25rem;color:#222}.Tags-module--tags__list-item-link--3SL_8:focus,.Tags-module--tags__list-item-link--3SL_8:hover{color:#5d93ff}.Post-module--post__comments--25y6I,.Post-module--post__footer--3WzWU{max-width:40rem;margin:0 auto;padding:0 .9375rem}.Post-module--post__home-button--16Kl0{display:block;max-width:5.625rem;height:2.1875rem;padding:0 1.5rem;line-height:2.1875rem;text-align:center;color:#222;border:1px solid #e6e6e6;border-radius:1.25rem;font-size:1rem;font-weight:400;margin-left:auto;margin-right:auto;margin-top:1.625rem}.Post-module--post__home-button--16Kl0:focus,.Post-module--post__home-button--16Kl0:hover{color:#5d93ff}@media screen and (min-width:960px){.Post-module--post__comments--25y6I,.Post-module--post__footer--3WzWU{padding:0}.Post-module--post__home-button--16Kl0{position:fixed;max-width:auto;margin:0;top:30px;left:30px}}</style><meta name="generator" content="Gatsby 2.19.7"/><link rel="alternate" type="application/rss+xml" title="Daewoong&#x27;s Dev Blog" href="/rss.xml"/><style type="text/css">
    .anchor.before {
      position: absolute;
      top: 0;
      left: 0;
      transform: translateX(-100%);
      padding-right: 4px;
    }
    .anchor.after {
      display: inline-block;
      padding-left: 4px;
    }
    h1 .anchor svg,
    h2 .anchor svg,
    h3 .anchor svg,
    h4 .anchor svg,
    h5 .anchor svg,
    h6 .anchor svg {
      visibility: hidden;
    }
    h1:hover .anchor svg,
    h2:hover .anchor svg,
    h3:hover .anchor svg,
    h4:hover .anchor svg,
    h5:hover .anchor svg,
    h6:hover .anchor svg,
    h1 .anchor:focus svg,
    h2 .anchor:focus svg,
    h3 .anchor:focus svg,
    h4 .anchor:focus svg,
    h5 .anchor:focus svg,
    h6 .anchor:focus svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          let scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop
          let clientTop = document.documentElement.clientTop || document.body.clientTop || 0
          var offset = element.getBoundingClientRect().top + scrollTop - clientTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 0)
          }), 0)
        }
      }
    })
  </script><link rel="preconnect dns-prefetch" href="https://www.google-analytics.com"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-155111945-1"></script><script>
      
      
      if(true) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){window.dataLayer && window.dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-155111945-1', {"send_page_view":false});
      }
      </script><link rel="sitemap" type="application/xml" href="/sitemap.xml"/><link rel="icon" href="/icons/icon-48x48.png?v=15a2d068d2ba2e8d55a68b19273a871b"/><link rel="manifest" href="/manifest.webmanifest"/><meta name="theme-color" content="#F7A046"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=15a2d068d2ba2e8d55a68b19273a871b"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=15a2d068d2ba2e8d55a68b19273a871b"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=15a2d068d2ba2e8d55a68b19273a871b"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=15a2d068d2ba2e8d55a68b19273a871b"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=15a2d068d2ba2e8d55a68b19273a871b"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=15a2d068d2ba2e8d55a68b19273a871b"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=15a2d068d2ba2e8d55a68b19273a871b"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=15a2d068d2ba2e8d55a68b19273a871b"/><title data-react-helmet="true">React Immutability - Daewoong&#x27;s Dev Blog</title><meta data-react-helmet="true" name="description" content="immer를 사용하여 React 불변성 쉽게 유지하기"/><meta data-react-helmet="true" property="og:site_name" content="React Immutability - Daewoong&#x27;s Dev Blog"/><meta data-react-helmet="true" property="og:image" content="https://daewoongbang.github.io//"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:title" content="React Immutability - Daewoong&#x27;s Dev Blog"/><meta data-react-helmet="true" name="twitter:description" content="immer를 사용하여 React 불변성 쉽게 유지하기"/><meta data-react-helmet="true" name="twitter:image" content="https://daewoongbang.github.io//"/><meta data-react-helmet="true" name="google-site-verification" content="nMhiuW1OxkSWjxObk9GntzMMYDn490ygBL7XBETJd6w"/><link as="script" rel="preload" href="/webpack-runtime-83e6226f2905fd3d49b9.js"/><link as="script" rel="preload" href="/netlify-identity-widget-8e6f024872c0d48ae324.js"/><link as="script" rel="preload" href="/app-2da56857efb96b9f3000.js"/><link as="script" rel="preload" href="/styles-117479406f6e61ad4793.js"/><link as="script" rel="preload" href="/commons-a41406135c29f6f1b1f0.js"/><link as="script" rel="preload" href="/component---src-templates-post-template-js-f43ca26067a100309d29.js"/><link as="fetch" rel="preload" href="/page-data/posts/react/react-immutability/page-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" role="group" id="gatsby-focus-wrapper"><div class="Layout-module--layout--3Pyz6"><div><div class="home_button"><a class="Post-module--post__home-button--16Kl0" href="/">All Posts</a></div><div><div class="content"><div class="Content-module--content--3p512"><h1 class="Content-module--content__title--2BDW9">React Immutability</h1><div class="Content-module--content__body--2TrQ-"><p>React에서 <strong>불변성을 지킨다</strong>는 것은 기존의 값을 수정하지 않으면서 새로운 값을 만들어 내는 것을 말한다. 불변성이 지켜지지 않으면 객체 내부의 값이 새로워져도 기존의 값과 비교할 수가 없으므로 바뀐 것을 감지하지 못한다. 아래는 불변성을 지키는 간단한 예시 코드이다.</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token comment">// 기존 배열</span>
<span class="token keyword">const</span> array <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> nextArray <span class="token operator">=</span> array<span class="token punctuation">;</span> <span class="token comment">// 배열을 복사하는 것이 아닌 똑같은 배열을 가리킨다.</span>
nextArray<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">7</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>array <span class="token operator">===</span> nextArray<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 완전히 같은 배열이기 때문에 true</span>

<span class="token keyword">const</span> nextArray2 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span>array<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 배열 내부의 값을 모두 복사</span>
nextArray2<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">7</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>array <span class="token operator">===</span> nextArray2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 다른 배열이기 때문에 false</span>

<span class="token comment">// 기존 객체</span>
<span class="token keyword">const</span> object <span class="token operator">=</span> <span class="token punctuation">{</span>
  value<span class="token operator">:</span> <span class="token number">1</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> nextObject <span class="token operator">=</span> object<span class="token punctuation">;</span> <span class="token comment">// 객체가 복사되지 않고 똑같은 객체를 가리킨다.</span>
nextObject<span class="token punctuation">.</span>value <span class="token operator">=</span> nexrObject<span class="token punctuation">.</span>value <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>object <span class="token operator">===</span> nextObject<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 같은 객체이기 때문에 true</span>

<span class="token keyword">const</span> nextObject2 <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span>object<span class="token punctuation">,</span> <span class="token comment">// 기존에 있던 내용 모두 복사</span>
  value<span class="token operator">:</span> object<span class="token punctuation">.</span>value <span class="token operator">+</span> <span class="token number">1</span> <span class="token comment">// 새로운 값</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>object <span class="token operator">===</span> nextObject2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 다른 객체이기 때문에 false</span></code></pre></div>
<p>하지만 <strong>전개 연산자(…문법)</strong>를 사용한다고 해서 객체나 배열 내부의 값을 완전히 복사하지 못한다. 이 것을 <strong>얕은 복사</strong>라고 하는데 즉, 내부의 값이 완전히 새로 복사되는 것이 아니라 가장 바깥 쪽에 있는 값만 복사가 된다. 따라서 내부의 값이 배열 혹은 객체가 포함되어 있다면 이 값 또한 따로 복사해 주어야 한다. 아래는 예시 코드이다.</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> todos <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> id<span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span> checked<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span> id<span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">,</span> checked<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> nextTodos <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span>todos<span class="token punctuation">]</span><span class="token punctuation">;</span>

nextTodos<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>checked <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>todos<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">===</span> nextTodos<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 얕은 복사이므로 똑같은 객체를 가리키고 있어 true</span>

nextTodos<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    nextTodos<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    checked<span class="token operator">:</span> <span class="token boolean">false</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>todos<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">===</span> nextTodos<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 새로운 객체를 할당했기 때문에 true</span></code></pre></div>
<p>구조가 간단하다면 이렇게 불변성을 유지하는데 크게 어려움이 없겠지만 구조가 복잡해질수록 이렇게 불변성을 유지하면서 업데이트하는 것이 정말 까다로워진다. 이때 immer라는 라이브러리를 사용하면 더 쉽게 불변성을 유지할 수 있다.</p>
<p>우선 프로젝트에 immer를 적용하고 싶을 경우 immer를 설치해야 한다.</p>
<p><code class="language-text">yarn add immer</code></p>
<p>아래는 immer를 사용하여 불변성을 유지하는 예시 코드 이다.</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">import</span> produce <span class="token keyword">from</span> <span class="token string">'immer'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> originalState <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    id<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    todo<span class="token operator">:</span> <span class="token string">'React 공부하기'</span><span class="token punctuation">,</span>
    checked<span class="token operator">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    id<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
    todo<span class="token operator">:</span> <span class="token string">'Blog 포스팅'</span><span class="token punctuation">,</span>
    checked<span class="token operator">:</span> <span class="token boolean">false</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> nextState <span class="token operator">=</span> <span class="token function">produce</span><span class="token punctuation">(</span>originalState<span class="token punctuation">,</span> <span class="token parameter">draft</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token comment">// id가 2인 항목의 checkd 값을 true로 변경</span>
  <span class="token keyword">const</span> todo <span class="token operator">=</span> draft<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token parameter">t</span> <span class="token operator">=></span> t<span class="token punctuation">.</span>id <span class="token operator">===</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  todo<span class="token punctuation">.</span>checked <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

  <span class="token comment">// 새로운 데이터 추가</span>
  draft<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    id<span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
    todo<span class="token operator">:</span> <span class="token string">'immer 사용해보기'</span><span class="token punctuation">,</span>
    checked<span class="token operator">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// id가 1인 항목 제거</span>
  draft<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>
    draft<span class="token punctuation">.</span><span class="token function">findIndex</span><span class="token punctuation">(</span><span class="token parameter">t</span> <span class="token operator">=></span> t<span class="token punctuation">.</span>id <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token number">1</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p><strong>produce</strong> 라는 함수는 두 가지 파라미터를 받는다. 첫 번째는 <strong>수정하고 싶은 상태</strong>이고, 두 번째는 <strong>상태를 어떻게 업데이트할지 정의하는 함수</strong>이다. 두 번째 파라미터로 전달되는 함수 내부에서 원하는 값을 변경하면, produce 함수가 불변성 유지를 대신해주면서 새로운 상태를 생성해준다. 코드만 보면 불변성 관리를 하지 않는 것처럼 보이지만 복잡한 데이터도 불변성 관리를 제대로 해준다.</p>
<p>아래는 컴포넌트에 immer를 적용한 코드이다.</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> useRef<span class="token punctuation">,</span> useCallback<span class="token punctuation">,</span> useState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> produce <span class="token keyword">from</span> <span class="token string">'immer'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">FormUseImmer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> nextId <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>form<span class="token punctuation">,</span> setForm<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span> username<span class="token operator">:</span> <span class="token string">''</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>data<span class="token punctuation">,</span> setData<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    array<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    uselessValue<span class="token operator">:</span> <span class="token keyword">null</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// input 수정</span>
  <span class="token keyword">const</span> onChange <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span>
    <span class="token parameter">e</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> <span class="token punctuation">{</span> name<span class="token punctuation">,</span> value <span class="token punctuation">}</span> <span class="token operator">=</span> e<span class="token punctuation">.</span>target<span class="token punctuation">;</span>
      <span class="token comment">// 기존 코드 주석 처리</span>
      <span class="token comment">//   setForm({</span>
      <span class="token comment">//     ...form,</span>
      <span class="token comment">//     [name]: [value]</span>
      <span class="token comment">//   });</span>
      <span class="token comment">// immer를 적용한 코드</span>
      <span class="token function">setForm</span><span class="token punctuation">(</span>
        <span class="token function">produce</span><span class="token punctuation">(</span>form<span class="token punctuation">,</span> <span class="token parameter">draft</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
          draft<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> value<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span>form<span class="token punctuation">]</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// form 등록</span>
  <span class="token keyword">const</span> onSubmit <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span>
    <span class="token parameter">e</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      e<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> info <span class="token operator">=</span> <span class="token punctuation">{</span>
        id<span class="token operator">:</span> nextId<span class="token punctuation">.</span>current<span class="token punctuation">,</span>
        name<span class="token operator">:</span> form<span class="token punctuation">.</span>name<span class="token punctuation">,</span>
        username<span class="token operator">:</span> form<span class="token punctuation">.</span>username
      <span class="token punctuation">}</span><span class="token punctuation">;</span>

      <span class="token comment">// array에 새 항목 등록</span>
      <span class="token comment">// 기존 코드 주석 처리</span>
      <span class="token comment">//   setData({</span>
      <span class="token comment">//     ...data,</span>
      <span class="token comment">//     array: data.array.concat(info)</span>
      <span class="token comment">//   });</span>
      <span class="token comment">// immer를 적용한 코드</span>
      <span class="token function">setData</span><span class="token punctuation">(</span>
        <span class="token function">produce</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token parameter">draft</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
          draft<span class="token punctuation">.</span>array<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>info<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// form 초기화</span>
      <span class="token function">setForm</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        name<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
        username<span class="token operator">:</span> <span class="token string">''</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      nextId<span class="token punctuation">.</span>current <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span>data<span class="token punctuation">,</span> form<span class="token punctuation">.</span>name<span class="token punctuation">,</span> form<span class="token punctuation">.</span>username<span class="token punctuation">]</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 항목 삭제</span>
  <span class="token keyword">const</span> onRemove <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span>
    <span class="token parameter">id</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      <span class="token comment">// 기존 코드 주석 처리</span>
      <span class="token comment">//   setData({</span>
      <span class="token comment">//     ...data,</span>
      <span class="token comment">//     array: data.array.filter(info => info.id !== id)</span>
      <span class="token comment">//   });</span>
      <span class="token comment">// immer를 적용한 코드</span>
      <span class="token function">setData</span><span class="token punctuation">(</span>
        <span class="token function">produce</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token parameter">draft</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
          draft<span class="token punctuation">.</span>array<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>
            draft<span class="token punctuation">.</span>array<span class="token punctuation">.</span><span class="token function">findIndex</span><span class="token punctuation">(</span><span class="token parameter">info</span> <span class="token operator">=></span> info<span class="token punctuation">.</span>id <span class="token operator">===</span> id<span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token number">1</span>
          <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span>data<span class="token punctuation">]</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">onSubmit</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>onSubmit<span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span>
          <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>username<span class="token punctuation">"</span></span>
          <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>ID<span class="token punctuation">"</span></span>
          <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>form<span class="token punctuation">.</span>username<span class="token punctuation">}</span></span>
          <span class="token attr-name">onChange</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>onChange<span class="token punctuation">}</span></span>
        <span class="token punctuation">/></span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span>
          <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>name<span class="token punctuation">"</span></span>
          <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>NAME<span class="token punctuation">"</span></span>
          <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>form<span class="token punctuation">.</span>name<span class="token punctuation">}</span></span>
          <span class="token attr-name">onChange</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>onChange<span class="token punctuation">}</span></span>
        <span class="token punctuation">/></span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token plain-text">등록</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">></span></span><span class="token plain-text">
          </span><span class="token punctuation">{</span>data<span class="token punctuation">.</span>array<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">info</span> <span class="token operator">=></span> <span class="token punctuation">(</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">key</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>info<span class="token punctuation">.</span>id<span class="token punctuation">}</span></span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">onRemove</span><span class="token punctuation">(</span>info<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">
              </span><span class="token punctuation">{</span>info<span class="token punctuation">.</span>username<span class="token punctuation">}</span><span class="token plain-text"> (</span><span class="token punctuation">{</span>info<span class="token punctuation">.</span>name<span class="token punctuation">}</span><span class="token plain-text">)
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>
          <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> FormUseImmer<span class="token punctuation">;</span></code></pre></div>
<p>immer를 사용하면 객체 안에 있는 값을 직접 수정하거나, 배열에 직접적인 변화를 일으키는 push, splice 등의 함수를 사용해도 괜찮다. 하지만 immer를 사용한다고 해서 무조건 코드가 깔끔해지는 것은 아니다. onRemove의 경우 filter를 사용하는 것이 더 간단할 수 있으므로 immer는 불변성을 유지하기가 너무 복잡할 경우에만 사용해도 충분하다.</p>
<h3 id="usestate의-함수형-업데이트와-immer-함께-쓰기" style="position:relative;"><a href="#usestate%EC%9D%98-%ED%95%A8%EC%88%98%ED%98%95-%EC%97%85%EB%8D%B0%EC%9D%B4%ED%8A%B8%EC%99%80-immer-%ED%95%A8%EA%BB%98-%EC%93%B0%EA%B8%B0" aria-label="usestate의 함수형 업데이트와 immer 함께 쓰기 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>useState의 함수형 업데이트와 immer 함께 쓰기</h3>
<p>immer와 useState의 함수형 업데이트를 함께 사용하면 코드를 더욱 깔끔하게 만들 수 있다.</p>
<p>우선 함수형 업데이트는 함수가 계속 만들어지는 상황을 방지하기 위해 사용한다. 이런 상황을 방지하는 방법은 두 가지이다. 하나는 방금 이야기한 useState의 함수형 업데이트 기능을 사용하는 것이고, 두 번째는 useReducer를 사용하는 것이다. 아래 코드는 useState의 함수형 업데이트 예시이다.</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">const</span> <span class="token punctuation">[</span>number<span class="token punctuation">,</span> setNumber<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// prevNumber는 현재 number값을 가리킨다.</span>
<span class="token keyword">const</span> onIncrease <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span>
  <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setNumber</span><span class="token punctuation">(</span><span class="token parameter">prevNumber</span> <span class="token operator">=></span> prevNumber <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p><code class="language-text">setNumber(number + 1)</code> 이라고 하지 않고 어떻게 업데이트할지 정의해주는 업데이트 함수를 넣어주었다. 이렇게 정의할 경우 useCallback을 사용할 때 두 번째 파라미터 배열에 number를 넣지 않아도 된다. 아래는 FormUseImmer 컴포넌트를 함수형 업데이트로 변경한 코드이다.</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> useRef<span class="token punctuation">,</span> useCallback<span class="token punctuation">,</span> useState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> produce <span class="token keyword">from</span> <span class="token string">'immer'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">FormUseImmerFU</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> nextId <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>form<span class="token punctuation">,</span> setForm<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span> username<span class="token operator">:</span> <span class="token string">''</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>data<span class="token punctuation">,</span> setData<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    array<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    uselessValue<span class="token operator">:</span> <span class="token keyword">null</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// input 수정</span>
  <span class="token keyword">const</span> onChange <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span><span class="token parameter">e</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> name<span class="token punctuation">,</span> value <span class="token punctuation">}</span> <span class="token operator">=</span> e<span class="token punctuation">.</span>target<span class="token punctuation">;</span>
    <span class="token comment">//   setForm(</span>
    <span class="token comment">//     produce(form, draft => {</span>
    <span class="token comment">//       draft[name] = value;</span>
    <span class="token comment">//     })</span>
    <span class="token comment">//   );</span>
    <span class="token comment">// 함수형 업데이트로 변경</span>
    <span class="token function">setForm</span><span class="token punctuation">(</span>
      <span class="token function">produce</span><span class="token punctuation">(</span><span class="token parameter">draft</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
        draft<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> value<span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// form 등록</span>
  <span class="token keyword">const</span> onSubmit <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span>
    <span class="token parameter">e</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      e<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> info <span class="token operator">=</span> <span class="token punctuation">{</span>
        id<span class="token operator">:</span> nextId<span class="token punctuation">.</span>current<span class="token punctuation">,</span>
        name<span class="token operator">:</span> form<span class="token punctuation">.</span>name<span class="token punctuation">,</span>
        username<span class="token operator">:</span> form<span class="token punctuation">.</span>username
      <span class="token punctuation">}</span><span class="token punctuation">;</span>

      <span class="token function">setData</span><span class="token punctuation">(</span>
        <span class="token comment">// 함수형 업데이트로 변경</span>
        <span class="token function">produce</span><span class="token punctuation">(</span><span class="token parameter">draft</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
          draft<span class="token punctuation">.</span>array<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>info<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// form 초기화</span>
      <span class="token function">setForm</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        name<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
        username<span class="token operator">:</span> <span class="token string">''</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      nextId<span class="token punctuation">.</span>current <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span>form<span class="token punctuation">.</span>name<span class="token punctuation">,</span> form<span class="token punctuation">.</span>username<span class="token punctuation">]</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 항목 삭제</span>
  <span class="token keyword">const</span> onRemove <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span><span class="token parameter">id</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">setData</span><span class="token punctuation">(</span>
      <span class="token comment">// 함수형 업데이트로 변경</span>
      <span class="token function">produce</span><span class="token punctuation">(</span><span class="token parameter">draft</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
        draft<span class="token punctuation">.</span>array<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>
          draft<span class="token punctuation">.</span>array<span class="token punctuation">.</span><span class="token function">findIndex</span><span class="token punctuation">(</span><span class="token parameter">info</span> <span class="token operator">=></span> info<span class="token punctuation">.</span>id <span class="token operator">===</span> id<span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token number">1</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">onSubmit</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>onSubmit<span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span>
          <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>username<span class="token punctuation">"</span></span>
          <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>ID<span class="token punctuation">"</span></span>
          <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>form<span class="token punctuation">.</span>username<span class="token punctuation">}</span></span>
          <span class="token attr-name">onChange</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>onChange<span class="token punctuation">}</span></span>
        <span class="token punctuation">/></span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span>
          <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>name<span class="token punctuation">"</span></span>
          <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>NAME<span class="token punctuation">"</span></span>
          <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>form<span class="token punctuation">.</span>name<span class="token punctuation">}</span></span>
          <span class="token attr-name">onChange</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>onChange<span class="token punctuation">}</span></span>
        <span class="token punctuation">/></span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token plain-text">등록</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">></span></span><span class="token plain-text">
          </span><span class="token punctuation">{</span>data<span class="token punctuation">.</span>array<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">info</span> <span class="token operator">=></span> <span class="token punctuation">(</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">key</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>info<span class="token punctuation">.</span>id<span class="token punctuation">}</span></span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">onRemove</span><span class="token punctuation">(</span>info<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">
              </span><span class="token punctuation">{</span>info<span class="token punctuation">.</span>username<span class="token punctuation">}</span><span class="token plain-text"> (</span><span class="token punctuation">{</span>info<span class="token punctuation">.</span>name<span class="token punctuation">}</span><span class="token plain-text">)
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>
          <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> FormUseImmerFU<span class="token punctuation">;</span></code></pre></div>
<p>immer는 컴포넌트의 불변성을 유지하기가 까다로운 경우에 사용한다면 생산성을 크게 높일 수 있다. 그렇지 않을 경우에는 immer를 사용하지 않는 경우가 더 편한 경우도 있으므로 사용 전 충분히 고려해보도록 하자.</p>
<hr>
<p><strong>reference:</strong></p>
<ul>
<li>immer docs<br>
<a href="https://immerjs.github.io/immer/docs/introduction" target="_blank" rel="nofollow noopener noreferrer">https://immerjs.github.io/immer/docs/introduction</a></li>
</ul></div></div></div></div><div class="Post-module--post__footer--3WzWU"><div><p class="Meta-module--meta__date--29eD7">Published <!-- -->3 Feb 2020</p></div><div class="Tags-module--tags--1L_ct"><ul class="Tags-module--tags__list--91FqN"><li class="Tags-module--tags__list-item--1M30P"><a class="Tags-module--tags__list-item-link--3SL_8" href="/tag/react/">React</a></li><li class="Tags-module--tags__list-item--1M30P"><a class="Tags-module--tags__list-item-link--3SL_8" href="/tag/immutability/">Immutability</a></li></ul></div><div class="Author-module--author--2Yefr"><p>Carpe diem!<a class="Author-module--author__bio-twitter--n-O9n" href="mailto:" rel="noopener noreferrer" target="_blank"><strong>Daewoong Bang</strong></a></p></div></div><div class="Post-module--post__comments--25y6I"><div><div id="disqus_thread"></div></div></div></div></div></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/posts/react/react-immutability";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-2da56857efb96b9f3000.js"],"component---node-modules-gatsby-plugin-offline-app-shell-js":["/component---node-modules-gatsby-plugin-offline-app-shell-js-cf2fd0f92da7499f18b1.js"],"component---src-templates-not-found-template-js":["/component---src-templates-not-found-template-js-7abc22eb377af40f89a1.js"],"component---src-templates-tags-list-template-js":["/component---src-templates-tags-list-template-js-a6fc8122a3a6473f95e0.js"],"component---src-templates-categories-list-template-js":["/component---src-templates-categories-list-template-js-b76a965f207ca7381362.js"],"component---src-templates-page-template-js":["/component---src-templates-page-template-js-30c9f68011554c8c6d0c.js"],"component---src-templates-post-template-js":["/component---src-templates-post-template-js-f43ca26067a100309d29.js"],"component---src-templates-tag-template-js":["/component---src-templates-tag-template-js-c657d0fe7aba4a2367a2.js"],"component---src-templates-category-template-js":["/component---src-templates-category-template-js-b7f06dc58e8dcbee435c.js"],"component---src-templates-index-template-js":["/component---src-templates-index-template-js-02100b555e21870c7cda.js"]};/*]]>*/</script><script src="/component---src-templates-post-template-js-f43ca26067a100309d29.js" async=""></script><script src="/commons-a41406135c29f6f1b1f0.js" async=""></script><script src="/styles-117479406f6e61ad4793.js" async=""></script><script src="/app-2da56857efb96b9f3000.js" async=""></script><script src="/netlify-identity-widget-8e6f024872c0d48ae324.js" async=""></script><script src="/webpack-runtime-83e6226f2905fd3d49b9.js" async=""></script></body></html>